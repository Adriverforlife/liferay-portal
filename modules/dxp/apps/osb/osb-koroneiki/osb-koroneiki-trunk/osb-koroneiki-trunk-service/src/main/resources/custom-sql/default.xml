<?xml version="1.0"?>

<custom-sql>
	<sql id="com.liferay.osb.koroneiki.trunk.service.persistence.ProductConsumptionFinder.countByContact">
		<![CDATA[
			SELECT
				COUNT(DISTINCT Koroneiki_Contact.contactId) AS COUNT_VALUE
			FROM
				Koroneiki_ProductConsumption
			INNER JOIN
				Koroneiki_ContactAccountRole ON
					Koroneiki_ContactAccountRole.accountId = Koroneiki_ProductConsumption.accountId
			INNER JOIN
				Koroneiki_Contact ON
					Koroneiki_Contact.contactId = Koroneiki_ContactAccountRole.contactId
			WHERE
				Koroneiki_ContactAccountRole.contactId = ?
		]]>
	</sql>
	<sql id="com.liferay.osb.koroneiki.trunk.service.persistence.ProductConsumptionFinder.findByContact">
		<![CDATA[
			SELECT
				DISTINCT {Koroneiki_ProductConsumption.*}
			FROM
				Koroneiki_ProductConsumption
			INNER JOIN
				Koroneiki_ContactAccountRole ON
					Koroneiki_ContactAccountRole.accountId = Koroneiki_ProductConsumption.accountId
			INNER JOIN
				Koroneiki_Contact ON
					Koroneiki_Contact.contactId = Koroneiki_ContactAccountRole.contactId
			WHERE
				Koroneiki_ContactAccountRole.contactId = ?
		]]>
	</sql>
	<sql id="com.liferay.osb.koroneiki.trunk.service.persistence.ProductEntryFinder.countByAccount">
		<![CDATA[
			SELECT
				COUNT(DISTINCT Koroneiki_ProductEntry.productEntryId) AS COUNT_VALUE
			FROM
				Koroneiki_ProductEntry
			INNER JOIN
				Koroneiki_ProductPurchase ON
					Koroneiki_ProductEntry.productEntryId = Koroneiki_ProductPurchase.productEntryId
			INNER JOIN
				Koroneiki_Account ON
					Koroneiki_ProductPurchase.accountId = Koroneiki_Account.accountId
				[$JOIN$]
			WHERE
				[$WHERE$]
				Koroneiki_Account.accountId = ?
		]]>
	</sql>
	<sql id="com.liferay.osb.koroneiki.trunk.service.persistence.ProductEntryFinder.findByAccount">
		<![CDATA[
			SELECT
				DISTINCT {Koroneiki_ProductEntry.*}
			FROM
				Koroneiki_ProductEntry
			INNER JOIN
				Koroneiki_ProductPurchase ON
					Koroneiki_ProductEntry.productEntryId = Koroneiki_ProductPurchase.productEntryId
			INNER JOIN
				Koroneiki_Account ON
					Koroneiki_ProductPurchase.accountId = Koroneiki_Account.accountId
			[$JOIN$]
			WHERE
				[$WHERE$]
				Koroneiki_Account.accountId = ?
		]]>
	</sql>
	<sql id="com.liferay.osb.koroneiki.trunk.service.persistence.ProductEntryFinder.joinByActive">
		<![CDATA[
			WHERE
				(Koroneiki_ProductPurchase.status != 600) AND
				(Koroneiki_ProductPurchase.startDate IS NULL) OR
				(
					(NOW() > Koroneiki_ProductPurchase.startDate) AND
					(NOW() < Koroneiki_ProductPurchase.endDate)
				)
		]]>
	</sql>
	<sql id="com.liferay.osb.koroneiki.trunk.service.persistence.ProductEntryFinder.joinByInactive">
		<![CDATA[
			LEFT JOIN
				(
					SELECT
						*
					FROM
						Koroneiki_ProductPurchase
					[$WHERE$]
				) ProductPurchase ON
					Koroneiki_ProductEntry.productEntryId = ProductPurchase.productEntryId
		]]>
	</sql>
	<sql id="com.liferay.osb.koroneiki.trunk.service.persistence.ProductEntryFinder.joinByProductPurchaseIdIsNull">
		<![CDATA[
			WHERE
				ProductPurchase.productPurchaseId IS NULL
		]]>
	</sql>
	<sql id="com.liferay.osb.koroneiki.trunk.service.persistence.ProductFieldFinder.findNameByClassNameId">
		<![CDATA[
			SELECT
				DISTINCT Koroneiki_ProductField.name
			FROM
				Koroneiki_ProductField
			WHERE
				Koroneiki_ProductField.classNameId = ?
		]]>
	</sql>
	<sql id="com.liferay.osb.koroneiki.trunk.service.persistence.ProductPurchaseFinder.countByContact">
		<![CDATA[
			SELECT
				COUNT(DISTINCT Koroneiki_Contact.contactId) AS COUNT_VALUE
			FROM
				Koroneiki_ProductPurchase
			INNER JOIN
				Koroneiki_ContactAccountRole ON
					Koroneiki_ContactAccountRole.accountId = Koroneiki_ProductPurchase.accountId
			INNER JOIN
				Koroneiki_Contact ON
					Koroneiki_Contact.contactId = Koroneiki_ContactAccountRole.contactId
			WHERE
				Koroneiki_ContactAccountRole.contactId = ?
		]]>
	</sql>
	<sql id="com.liferay.osb.koroneiki.trunk.service.persistence.ProductPurchaseFinder.findByContact">
		<![CDATA[
			SELECT
				DISTINCT {Koroneiki_ProductPurchase.*}
			FROM
				Koroneiki_ProductPurchase
			INNER JOIN
				Koroneiki_ContactAccountRole ON
					Koroneiki_ContactAccountRole.accountId = Koroneiki_ProductPurchase.accountId
			INNER JOIN
				Koroneiki_Contact ON
					Koroneiki_Contact.contactId = Koroneiki_ContactAccountRole.contactId
			WHERE
				Koroneiki_ContactAccountRole.contactId = ?
		]]>
	</sql>
</custom-sql>